<script src="dist/q2tools.js">
    
</script>
<script type="text/javascript">
    var extractor = new Quake2Tools.PakExtractor(false);
    var paginationSize = 30;
    var globalArchive = null;
    var filteredLumps = [];

    function updatePageSize() {
        var pageSize = document.getElementById("pageSize");
        paginationSize = pageSize.value;
    }

    function displayArchive(archive) {
        globalArchive = archive;

        for (var i=0; i< archive.lumps.length; i++) {
            filteredLumps.push(archive.lumps[i]);
        }

        loadArchivePage(0);
        displayPaginationButtons();
    }

    function search() {
        var searchTerm = document.getElementById("searchTerm");
        filteredLumps = [];

        console.log("searching: [" + searchTerm.value + "]");

        if (searchTerm.value.trim() === "") {
            filteredLumps = globalArchive.lumps;
        } else {
            for (var i=0; i < globalArchive.lumps.length; i++) {
                if (globalArchive.lumps[i].name.indexOf(searchTerm.value) > -1)
                    filteredLumps.push(globalArchive.lumps[i]);
            }
        }

        console.log(filteredLumps);

        loadArchivePage(0);
        displayPaginationButtons();
    }

    function displayPaginationButtons() {
        var paginationButtonList = document.getElementById("paginationButtonList");
        var paginationButtonListMarkup = "";
        
        var numberOfButtons = filteredLumps.length / paginationSize;

        for (var i =0 ; i< numberOfButtons; i++) {
            paginationButtonListMarkup += createPaginationButton(i);
        }
        paginationButtonList.innerHTML = paginationButtonListMarkup;
    }

    function loadArchivePage(pageNumber) {
        var pageNumberTextBox = document.getElementById("pageNumber");
        var lumpTable = document.getElementById("lumpTableBody");
        var tableDataMarkup = "";
        lumpTable.innerHTML = tableDataMarkup;
        
        var startIndex = (pageNumber * paginationSize);
        var endIndex = startIndex + paginationSize;

        for (var i = startIndex; i < endIndex; i++) {
            if (filteredLumps[i]) {
                tableDataMarkup += createTableRow(filteredLumps[i].name, (filteredLumps[i].length / 1024).toFixed(2));
            }
            
        }

        lumpTable.innerHTML = tableDataMarkup;
        pageNumberTextBox.setAttribute("value", pageNumber + 1);
    }

    function createTableRow() {
        var markup = "";
        for (var a=0; a < arguments.length; a++) {
            markup += createTableColumn(arguments[a]);
        }
        return "<tr>" + markup + "</tr>";
    }

    function createTableColumn(data) {
        return "<td>"+data+"</td>";
    }
    function createPaginationButton(pageNumber) {
        return '<button onclick="loadArchivePage('+pageNumber+')">'+(pageNumber + 1)+'</button>';
    }
</script>

<input type="file" id="fileModel" onchange="extractor.setPakFile(event)" /><br/>
<button id="btnView" onclick="extractor.extractArchive(displayArchive)">View Archive</button>

<h3>Lumps</h3>
<label>Search: </label><input type="text" id="searchTerm"/><button onclick="search()">Search in Archive</button><br/>
<label>Page </label><input type="text" readonly id="pageNumber"/><br/>
Page Size<select id="pageSize" onchange="updatePageSize()">
    <option value="30" selected>30</option>
    <option value="50">50</option>
    <option value="100">100</option>
    <option value="200">200</option>
    <option value="500">500</option>
</select>
<table border="1">
    <thead>
        <th>Path</th>
        <th>Size (KB)</th>
    </thead>
    <tbody id="lumpTableBody">
        
    </tbody>
</table>
<div id="paginationButtonList">
    
</div>